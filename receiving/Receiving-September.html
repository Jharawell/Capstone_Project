<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/styles/Dashboard-Styles.css">
    <script src="../js/Dashboard-Function.js"></script>
    <title>September Table</title>
</head>

    <style>

        
        .cont{
            display:inline-block;
            width: 200px;
        }
        th{
            white-space: nowrap;
            color: black;
            background-color: yellow;
        }

        
        .table-custom {
        font-size: 20px;
        }

        .add-new-item{
            background-color: white;
        }

        td,tr{
            background-color: white;
            color: black;
        }

        .none{
            background-color: white;
        }
    </style>

    
<button class="drawer-toggle">â˜°</button>

<!-- Add Drawer -->
<div class="drawer">
    <div class="drawer-content">
        <h3>Menu</h3>
        <a href="../receiving/Receiving-Section-Staff.html">Dashboard</a>
        <a href="../receiving/Receiving-September.html">September</a>
        <a href="../receiving/receiving-trash.html">Trash</a>
        <a href="../auth/select-user-type.html">Logout</a>
    </div>
</div>

<style>
    /* Existing styles */
    body {
        background-color: #f5f5f5;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .cont{
        display:inline-block;
        width: 200px;
    }
    th{
        white-space: nowrap;
        color: black;
        background-color: yellow;
    }

    .table thead th {
        background-color: #2c3e50 !important;
        color: white !important;
        font-weight: 600;
        padding: 15px;
        border-bottom: 2px solid #34495e;
    }

    .table-custom {
        font-size: 16px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .table td {
        padding: 12px;
        vertical-align: middle;
        border-top: 1px solid #dee2e6;
        background-color: white;
    }

    .table tr:hover td {
        background-color: #f8f9fa;
    }

    .add-new-item{
        background-color: white;
    }

    /* New drawer styles */
    .drawer {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1000;
        top: 0;
        left: 0;
        background-color: #2c3e50;
        overflow-x: hidden;
        transition: all 0.3s ease-in-out;
        padding-top: 60px;
        box-shadow: none;
    }

    .drawer-content {
        padding: 20px;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .drawer-content h3 {
        color: white;
        font-size: 24px;
        margin-bottom: 25px;
        padding-left: 15px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 15px;
    }

    .drawer-content a {
        color: #ecf0f1;
        text-decoration: none;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin: 5px 15px;
        display: block;
        font-size: 16px;
    }

    .drawer-content a:hover {
    background-color: #34495e;
    color: white;
    transform: translateX(5px);
    }

    .drawer a {
        color: #ecf0f1;
        padding: 12px 15px;
        border-radius: 5px;
        margin-bottom: 5px;
        transition: all 0.3s ease;
    }

    .drawer a:hover {
        background-color: #34495e;
        color: white;
        transform: translateX(5px);
    }

    .drawer-toggle {
        background-color: #2c3e50;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .drawer-toggle:hover {
        background-color: #34495e;
    }

    .drawer.open {
        width: 280px;
    }

    .drawer-toggle {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background-color: #2c3e50;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .drawer-toggle:hover {
        background-color: #34495e;
    }

    .modal-content {
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
        background-color: #2c3e50;
        color: white;
        border-radius: 8px 8px 0 0;
    }

    .modal-title {
        font-weight: 600;
    }

    .modal-body {
        padding: 20px;
    }

    .modal-body label {
        font-weight: 500;
        color: #2c3e50;
    }

    .modal-body input {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 8px 12px;
        width: 100%;
        margin-bottom: 15px;
    }

    .modal-footer .btn {
        border-radius: 4px;
        padding: 8px 20px;
        font-weight: 500;
    }

    .btn-primary {
        background-color: #3498db;
        border-color: #3498db;
    }

    .btn-success {
        background-color: #2ecc71;
        border-color: #2ecc71;
    }

    .btn-danger {
        background-color: #e74c3c;
        border-color: #e74c3c;
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Container spacing */
    .container {
        padding: 30px;
        margin-top: 100px;
        transition: margin-left 0.3s;
    }

    .drawer.open + .container {
        margin-left: 280px;
    }
    .container.mt-3 {
        margin-top: 100px !important; 
    }
    .upper-container {
        background-color: white;
        padding: 20px;
        margin: auto 0;
        max-width: auto;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .upper-container h2 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .upper-container p {
        color: #7f8c8d;
        margin-bottom: 0;
    }

    /* Adjust existing container spacing */
    .container.mt-3 {
        margin-top: 30px !important;
    }
</style>

<script>
    document.querySelector('.drawer-toggle').addEventListener('click', function() {
        document.querySelector('.drawer').classList.toggle('open');
    });
</script>

<body>
    <div class="upper-container">
        <h2>September Records</h2>
        <p>Receiving Section Document Management</p>
    </div>

    <div class="container mt-3 d-flex justify-content-center">
        <table class="table table-dark table-custom">

    <div class = "container mt-3 d-flex justify-content-center">
        <table class = "table table-dark table-custom">
            <thead>
                <th>No.</th>
                <th>Ctrl No.</th>
                <th>Letter Type</th>
                <th>Time Received</th>
                <th>Date Received</th>
                <th>From</th>
                <th>Office</th>
                <th>Subject</th>
                <th>Time Received</th>
                <th>Date Received</th>
                <th>Endorsed To</th>
                <th>Remarks</th>
                <th>Status</th>
                <th>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes(null)">
                        Add New Record
                    </button>
                </th>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>
    
  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" style="display: none;" inert>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Control Panel</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>


        <div class="modal-body">
        
            <h5>----------------------Receiving----------------------</h5>
        
        <label class="cont">Ctrl No.: </label>
          <input type="text" id="ctrlMod"> <br>

        <label class="cont">Letter Type: </label>
        <input type="text" class="cont" id="typeMod" list="suggestions" placeholder="Enter Letter Type">
            <datalist id="suggestions">
                <option value="Complaint Letter">
                <option value="Request Letter">
                <option value="Business Letter">
                <option value="Inquiry Letter">
                
            </datalist>
             <br>   

        <label class="cont">Time Recieved: </label>
         <input type="time" id="timeMod"> <br>

        <label class="cont">Date Recieved: </label>
        <input type="date" id="dateMod"> <br>

        <label class="cont">From: </label>
        <input type="text" id="fromMod"> <br>

        <label class="cont">Office: </label>
        <input type="text" class="cont" id="officeMod" list="suggestions" placeholder="Enter Office">
          <datalist id="suggestions">
              <option value="Vice Mayor's Office">
              <option value="Sangguniang Panlungsod">
              <option value="CAO">
              <option value="CASSO">
              <option value="CADMO">
              <option value="CBO">
              <option value="CEPMO">
              <option value="CHRMO">
              <option value="CLO">
              <option value="CPDSO">
              <option value="CTO">
              <option value="GSO">
              <option value="CBAO">
              <option value="CEO">
              <option value="CSWDO">
              <option value="HSO">
              <option value="LCR">
              <option value="CVAO">
              <option value="DEPED">
              <option value="COA">
              <option value="MTCC">
              <option value="RTCC">
              <option value="Prosecutor's Office">
              <option value="DILG-City">
              <option value="BCPO">
              <option value="BFP">
              <option value="BJMP">
              <option value="PESO">
              <option value="PIO">
              <option value="PLD">
              <option value="PLEB">
              <option value="POSD">
              <option value="SSD">
              <option value="PDAO">
              <option value="MITD">
              <option value="CCTV">
              <option value="CDRRMO">
              <option value="LIBRARY">
              <option value="PERSONAL STAFF">
          </datalist>
         <br>

        <label class="cont">Subject: </label>
        <input type="text" id="subMod"> <br>

        <h5>------------------------Admin------------------------</h5>

        <label class="cont">Time Recieved: </label>
        <input type="text" id="TMod"> <br>

        <label class="cont">Date Recieved: </label>
        <input type="text" id="DMod"> <br>

        <label class="cont">Endorsed To: </label>
        <input type="text" id="EMod"> <br>

        <label class="cont">Remarks: </label>
        <input type="text" id="RMod"> <br>

        <label class="cont">Status: </label>
        <input type="text" id="SMod"> <br>


        </div>
        <div class="modal-footer">
          <button id="addModBtn" type="button" class="btn btn-primary" onclick="AddStd();">Add New Record</button>
          <button id="retModBtn" type="button" class="btn btn-primary" onclick="RetStd();">Retrieve</button>
          <button id="updModBtn" type="button" class="btn btn-success" onclick="UpdStd();">Update</button>
          <button id="delModBtn" type="button" class="btn btn-danger" onclick="DelStd();">Move to Trash</button>
        </div>
      </div>
    </div>
  </div>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script>
        $('#exampleModalCenter').on('show.bs.modal', function () {
            this.removeAttribute('inert');
        });

        $('#exampleModalCenter').on('hide.bs.modal', function () {
            this.setAttribute('inert', '');
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import {getDatabase, ref, child, onValue, get, set, update, remove}from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyCaSHRLbIRWW8COl5iwHb19dMDYYLJ2DIk",
            authDomain: "centralcomm-248a9.firebaseapp.com",
            databaseURL: "https://centralcomm-248a9-default-rtdb.firebaseio.com",
            projectId: "centralcomm-248a9",
            storageBucket: "centralcomm-248a9.firebasestorage.app",
            messagingSenderId: "796912003621",
            appId: "1:796912003621:web:0d6fd82e43399871a9edcc",
            measurementId: "G-CN0S9L5YV4"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

    window.AddStd = function() {
        const dataRef = ref(db, "September/" + ctrlMod.value);
        set(dataRef, {
            ctrl_No: ctrlMod.value,
            type: typeMod.value,
            time: timeMod.value,
            date: dateMod.value,
            from: fromMod.value,
            office: officeMod.value,
            subject: subjectMod.value,
            time2: TMod.value,
            date2: DMod.value,
            endorsed: EMod.value,
            remarks: RMod.value,
            status: SMod.value
        }).then(() => {
            alert("record was added");
            Select_AllData();
            $("#exampleModalCenter").modal('hide');
            location.reload();
        }).catch(error => {
            alert("record was not added, there was some problem: " + error.message);
            
        });
    };

    window.RetStd = function() {
        const dataRef = ref(db);
        get(child(dataRef, 'September/' + ctrlMod.value)).then((snapshot) =>{
            if(snapshot.exists()) {
                ctrlMod.value = snapshot.val().ctrl_No;
                typeMod.value = snapshot.val().type;
                timeMod.value = snapshot.val().time;
                dateMod.value = snapshot.val().date;
                fromMod.value = snapshot.val().from;
                officeMod.value = snapshot.val().office;
                subjectMod.value = snapshot.val().subject;
                TMod.value = snapshot.val().time2;
                DMod.value = snapshot.val().date2;
                EMod.value = snapshot.val().endorsed;
                RMod.value = snapshot.val().remarks;
                SMod,value = snapshot.val().status;
            }
            else{
                alert("document does not exist");
                location.reload();
            }
        })
        .catch(error => {
            alert("Unsuccessful");
            console.log(error);
        })
    }

    window.UpdStd = function() {
        const dataRef = ref(db, "September/" + ctrlMod.value); 
        update(dataRef, {
            ctrl_No: ctrl_No.value,
            type: typeMod.value,
            time: timeMod.value,
            date: dateMod.value,
            from: fromMod.value,
            office: officeMod.value,
            subject: subjectMod.value,
            time2: TMod.value,
            date2: DMod.value,
            endorsed: EMod.value,
            remarks: RMod.value,
            status: SMod.value
        }).then(() => {
            alert("Record was updated");
            Select_AllData(); 
            $("#exampleModalCenter").modal('hide');
            location.reload();
        }).catch(error => {
            alert("There was an error updating the record: " + error.message);
            
        });
    };

    window.DelStd = async function() {
        const recordKey = ctrlMod.value; // using your control number as the key
        const SeptemberRef = ref(db, "September/" + recordKey);
        const trashRef = ref(db, "trash/" + recordKey);
        
        try {
            // Retrieve the record data
            const snapshot = await get(SeptemberRef);
            if (snapshot.exists()) {
                const itemData = snapshot.val();
                
                // Copy the data to the trash node
                await set(trashRef, itemData);
                
                // Remove the record from September
                await remove(SeptemberRef);
                
                alert("Record moved to trash successfully");
                location.reload();
            } else {
                alert("Record not found");
            }
            } catch (error) {
                console.error("Error moving record to trash:", error);
                alert("There was an error: " + error.message);
            }
        };

        var No;
        function Select_AllData() {
            document.getElementById('tbody1').innerHTML="";
            No=0;
            const db = getDatabase(app);
            const dataRef = ref(db, 'September');

            get(dataRef).then(snapshot => {
                snapshot.forEach(childSnapshot => {
                    const ctrl_No = childSnapshot.val().ctrl_No;
                    const type = childSnapshot.val().type;
                    const time = childSnapshot.val().time;
                    const date = childSnapshot.val().date;
                    const from = childSnapshot.val().from;
                    const office = childSnapshot.val().office;
                    const subject = childSnapshot.val().subject;
                    const time2 = childSnapshot.val().time2;
                    const date2 = childSnapshot.val().date2;
                    const endorsed = childSnapshot.val().endorsed;
                    const remarks = childSnapshot.val().remarks;
                    const status = childSnapshot.val().status;

                    AddItemToTable(ctrl_No, type, time, date, from, office, subject, time2, date2, endorsed, remarks, fC, status);
                });
            }).catch(error => {
                console.error("error fetching data: ", error);
            });
        }
        window.onload = Select_AllData;

        var No = 0;
        var ltList = [];
        var tbody = document.getElementById('tbody1');

        function AddItemToTable(ctrl_No, type, time, date, from, office, subject, time2, date2, endorsed, remarks, status ){
            let trow = document.createElement("tr");
              let td1 = document.createElement('td'); //No.
              let td2 = document.createElement('td'); //Ctrl_No
              let td3 = document.createElement('td'); //Type
              let td4 = document.createElement('td'); //Time
              let td5 = document.createElement('td'); //Date
              let td6 = document.createElement('td'); //From
              let td7 = document.createElement('td'); //Office
              let td8 = document.createElement('td'); //Subject
              let td9 = document.createElement('td'); //Time2
              let td10 = document.createElement('td'); //Date2
              let td11 = document.createElement('td'); //Endorsed
              let td12 = document.createElement('td'); //Remarks 
              let td13 = document.createElement('td'); //FC

            ltList.push([ctrl_No, type, time, date, from, office, subject, time2, date2, endorsed, remarks, status]);
            td1.innerHTML = ++No;
            td2.innerHTML = ctrl_No;
            td3.innerHTML = type;
            td4.innerHTML = time;
            td5.innerHTML = date;
            td6.innerHTML = from;
            td7.innerHTML = office;
            td8.innerHTML = subject;
            td9.innerHTML = time2;
            td10.innerHTML = date2;
            td11.innerHTML = endorsed;
            td12.innerHTML = remarks;
            td13.innerHTML = status;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);
            trow.appendChild(td7);
            trow.appendChild(td8);
            trow.appendChild(td9);
            trow.appendChild(td10);
            trow.appendChild(td11);
            trow.appendChild(td12);
            trow.appendChild(td13);

    
            var controlDiv = document.createElement("div");
            controlDiv.innerHTML = '<button type="button" class="btn btn-primary my-2 ml-2" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes('+No+')">Edit Record</button>'

            trow.appendChild(controlDiv);
            tbody.appendChild(trow);
        }

        var ctrl_No = document.getElementById('ctrlMod')
        var typeMod = document.getElementById('typeMod');
        var timeMod = document.getElementById('timeMod');
        var dateMod = document.getElementById('dateMod');
        var fromMod = document.getElementById('fromMod');
        var officeMod = document.getElementById('officeMod');
        var subjectMod = document.getElementById('subMod');
        var TMod = document.getElementById('TMod');
        var DMod = document.getElementById('DMod');
        var EMod = document.getElementById('EMod');
        var RMod = document.getElementById('RMod');
        var SMod = document.getElementById('SMod');
        
        var BTNmodAdd = document.getElementById('addModBtn');
        var BTNmodRet = document.getElementById('retModBtn');
        var BTNmodUpd = document.getElementById('updModBtn');
        var BTNmodDel = document.getElementById('delModBtn');
    

        function generateCtrlNo() {
            const dataRef = ref(db, 'September');
            get(dataRef).then(snapshot => {
                let maxCtrlNo = 0;
                snapshot.forEach(childSnapshot => {
                    const currentCtrlNo = parseInt(childSnapshot.val().ctrl_No, 10);
                    if (currentCtrlNo > maxCtrlNo) {
                        maxCtrlNo = currentCtrlNo;
                    }
                });

                const newCtrlNo = (maxCtrlNo + 1).toString().padStart(7, '0');
                ctrlMod.value = newCtrlNo;
            }).catch(error => {
                console.error("Error fetching data: ", error);
            });
        }

        window.FillTboxes=(index)=>{
            if(index==null){
                generateCtrlNo();
                const currentDate = new Date();
                const now = new Date();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const year = now.getFullYear();
                const formattedTime = currentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                typeMod.value = "";
                timeMod.value = formattedTime;
                dateMod.value = `${month}/${day}/${year}`;
                fromMod.value = "";
                officeMod.value = "";
                subjectMod.value = "";
                TMod.value = "";
                DMod.value = "";
                EMod.value = "";
                RMod.value = "";
                SMod.value = ""; 
//----------Enable Specifics (uncomment to enable)----------//
                // timeMod.disabled=true;
                // dateMod.disabled=true;
                // ctrlMod.disabled=true;
                // fromMod.disabled=true;
                // officeMod.disabled=true;
                // subjectMod.disabled=true;
                TMod.disabled = true;
                DMod.disabled = true;
                EMod.disabled = true;
                RMod.disabled = true;
                SMod.disabled = true; 

                BTNmodAdd.style.display='inline-block';
                BTNmodRet.style.display='none';
                BTNmodUpd.style.display='none';
                BTNmodDel.style.display='none';
            }
            else{
                --index;
                ctrlMod.value = ltList[index][0]
                typeMod.value = ltList[index][1];
                timeMod.value = ltList[index][2];
                dateMod.value = ltList[index][3];
                fromMod.value = ltList[index][4];
                officeMod.value = ltList[index][5];
                subjectMod.value = ltList[index][6];
                TMod.value = ltList[index][7];
                DMod.value = ltList[index][8];
                EMod.value = ltList[index][9];
                RMod.value = ltList[index][10];
                SMod.value = ltList[index][11]; 
//----------Disable Specifics (uncomment to disable)----------//
                // timeMod.disabled = true;
                // dateMod.disabled = true;
                // ctrlMod.disabled = true;
                // fromMod.disabled = true;
                // officeMod.disabled = true;
                // subjectMod.disabled = true;
                TMod.disabled = true;
                DMod.disabled = true;
                EMod.disabled = true;
                RMod.disabled = true;
                SMod.disabled = true; 
                BTNmodAdd.style.display='none';
                BTNmodRet.style.display='inline-block';
                BTNmodUpd.style.display='inline-block';
                BTNmodDel.style.display='inline-block';
            }
        }   

        function AddAllItemsToTable(September){
            No = 0;
            tbody.innerHTML="";
            September.forEach(element => {
                AddItemToTable(element.ctrl_No, element.type, element.time, element.date, element.from, element.office, element.subject, element.time2, element.date2, element.endorsed, element.remarks, element.status);
            });
        }    

//----------Fetch All Data----------//
        
        function GetAllDataOnce(){
            const dbref = ref(db);

            get(child(dbref, "September"))
            .then((snapshot)=>{
                var letters = [];

                snapshot.forEach(childSnapshot => {
                    letters.push(childSnapshot.val());
                });

                AddAllItemsToTable(letters);
            })

        }

        function GetAllDataRealtime(){
            const db = getDatabase(app);
            const dbref = ref(db, "September");

            onValue(dbref,(snapshot)=>{
                var letters = [];

                snapshot.forEach(childSnapshot => {
                    letters.push(childSnapshot.val());
                });

                AddAllItemsToTable(letters);
            });

        }

        window.onload = GetAllDataRealtime;
    </script>
</body>
</html>